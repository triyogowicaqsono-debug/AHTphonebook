<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Phone Book Driver</title>
<style>
body { font-family: Arial; margin: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; }
th { background: #f0f0f0; }
button { padding: 5px 10px; margin: 3px; }
a { color: green; text-decoration: none; font-weight: bold; }
.summary { margin-top: 20px; }
</style>
</head>
<body>

<h2>ðŸ“˜ Phone Book Driver</h2>

<input type="file" accept=".csv" onchange="importCSV(event)">
<button onclick="addRow()">âž• Tambah Data</button>

<table id="dataTable">
<thead>
<tr>
<th>Nama</th>
<th>Nomor HP (WA)</th>
<th>Status</th>
<th>Aksi</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="summary">
<h3>ðŸ“Š Rekapan Status Driver</h3>
<table id="summaryTable">
<thead>
<tr>
<th>Status</th>
<th>Qty</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
let data = [];

function formatWA(number) {
  number = number.replace(/[^0-9]/g, "");
  if (number.startsWith("0")) {
    number = "62" + number.substring(1);
  }
  return number;
}

function importCSV(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = e => {
    const lines = e.target.result.split("\n").slice(1);
    lines.forEach(line => {
      const [nama, nomor, status] = line.split(",");
      if (nama && nomor && status) {
        data.push({ 
          nama: nama.trim(), 
          nomor: nomor.trim(), 
          status: status.trim() 
        });
      }
    });
    renderTable();
  };
  reader.readAsText(file);
}

function renderTable() {
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";
  data.forEach((d, i) => {
    const wa = formatWA(d.nomor);
    tbody.innerHTML += `
    <tr>
      <td contenteditable oninput="data[${i}].nama=this.innerText">${d.nama}</td>
      <td contenteditable oninput="data[${i}].nomor=this.innerText">
        <a href="https://wa.me/${wa}" target="_blank">${d.nomor}</a>
      </td>
      <td contenteditable oninput="data[${i}].status=this.innerText">${d.status}</td>
      <td><button onclick="removeRow(${i})">ðŸ—‘</button></td>
    </tr>`;
  });
  renderSummary();
}

function addRow() {
  data.push({ nama: "Nama", nomor: "08xxxxxxxx", status: "Ready" });
  renderTable();
}

function removeRow(index) {
  data.splice(index, 1);
  renderTable();
}

function renderSummary() {
  const summary = {};
  data.forEach(d => {
    summary[d.status] = (summary[d.status] || 0) + 1;
  });

  const tbody = document.querySelector("#summaryTable tbody");
  tbody.innerHTML = "";
  for (let s in summary) {
    tbody.innerHTML += `
      <tr>
        <td>${s}</td>
        <td>${summary[s]}</td>
      </tr>`;
  }
}
</script>

</body>
</html>